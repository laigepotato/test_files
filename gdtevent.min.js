try{!function(e,t,n,i){"use strict";function r(e){var t=function(e,t){return e<<t|e>>>32-t},n=function(e,t){var n,i,r,o,a;return r=2147483648&e,o=2147483648&t,n=1073741824&e,i=1073741824&t,a=(1073741823&e)+(1073741823&t),n&i?2147483648^a^r^o:n|i?1073741824&a?3221225472^a^r^o:1073741824^a^r^o:a^r^o},i=function(e,t,n){return e&t|~e&n},r=function(e,t,n){return e&n|t&~n},o=function(e,t,n){return e^t^n},a=function(e,t,n){return t^(e|~n)},s=function(e,r,o,a,s,c,l){return e=n(e,n(n(i(r,o,a),s),l)),n(t(e,c),r)},c=function(e,i,o,a,s,c,l){return e=n(e,n(n(r(i,o,a),s),l)),n(t(e,c),i)},l=function(e,i,r,a,s,c,l){return e=n(e,n(n(o(i,r,a),s),l)),n(t(e,c),i)},u=function(e,i,r,o,s,c,l){return e=n(e,n(n(a(i,r,o),s),l)),n(t(e,c),i)},d=function(e){for(var t,n=e.length,i=n+8,r=16*((i-i%64)/64+1),o=Array(r-1),a=0,s=0;s<n;)a=s%4*8,o[t=(s-s%4)/4]=o[t]|e.charCodeAt(s)<<a,s++;return t=(s-s%4)/4,a=s%4*8,o[t]=o[t]|128<<a,o[r-2]=n<<3,o[r-1]=n>>>29,o},f=function(e){var t,n="",i="";for(t=0;t<=3;t++)n+=(i="0"+(e>>>8*t&255).toString(16)).substr(i.length-2,2);return n},h=function(e){e=e.toString().replace(/\x0d\x0a/g,"\n");for(var t="",n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t+=String.fromCharCode(i):i>127&&i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t};return function(e){var t,i,r,o,a,g,p,_,E,m=Array();for(e=h(e),m=d(e),g=1732584193,p=4023233417,_=2562383102,E=271733878,t=0;t<m.length;t+=16)i=g,r=p,o=_,a=E,g=s(g,p,_,E,m[t+0],7,3614090360),E=s(E,g,p,_,m[t+1],12,3905402710),_=s(_,E,g,p,m[t+2],17,606105819),p=s(p,_,E,g,m[t+3],22,3250441966),g=s(g,p,_,E,m[t+4],7,4118548399),E=s(E,g,p,_,m[t+5],12,1200080426),_=s(_,E,g,p,m[t+6],17,2821735955),p=s(p,_,E,g,m[t+7],22,4249261313),g=s(g,p,_,E,m[t+8],7,1770035416),E=s(E,g,p,_,m[t+9],12,2336552879),_=s(_,E,g,p,m[t+10],17,4294925233),p=s(p,_,E,g,m[t+11],22,2304563134),g=s(g,p,_,E,m[t+12],7,1804603682),E=s(E,g,p,_,m[t+13],12,4254626195),_=s(_,E,g,p,m[t+14],17,2792965006),p=s(p,_,E,g,m[t+15],22,1236535329),g=c(g,p,_,E,m[t+1],5,4129170786),E=c(E,g,p,_,m[t+6],9,3225465664),_=c(_,E,g,p,m[t+11],14,643717713),p=c(p,_,E,g,m[t+0],20,3921069994),g=c(g,p,_,E,m[t+5],5,3593408605),E=c(E,g,p,_,m[t+10],9,38016083),_=c(_,E,g,p,m[t+15],14,3634488961),p=c(p,_,E,g,m[t+4],20,3889429448),g=c(g,p,_,E,m[t+9],5,568446438),E=c(E,g,p,_,m[t+14],9,3275163606),_=c(_,E,g,p,m[t+3],14,4107603335),p=c(p,_,E,g,m[t+8],20,1163531501),g=c(g,p,_,E,m[t+13],5,2850285829),E=c(E,g,p,_,m[t+2],9,4243563512),_=c(_,E,g,p,m[t+7],14,1735328473),p=c(p,_,E,g,m[t+12],20,2368359562),g=l(g,p,_,E,m[t+5],4,4294588738),E=l(E,g,p,_,m[t+8],11,2272392833),_=l(_,E,g,p,m[t+11],16,1839030562),p=l(p,_,E,g,m[t+14],23,4259657740),g=l(g,p,_,E,m[t+1],4,2763975236),E=l(E,g,p,_,m[t+4],11,1272893353),_=l(_,E,g,p,m[t+7],16,4139469664),p=l(p,_,E,g,m[t+10],23,3200236656),g=l(g,p,_,E,m[t+13],4,681279174),E=l(E,g,p,_,m[t+0],11,3936430074),_=l(_,E,g,p,m[t+3],16,3572445317),p=l(p,_,E,g,m[t+6],23,76029189),g=l(g,p,_,E,m[t+9],4,3654602809),E=l(E,g,p,_,m[t+12],11,3873151461),_=l(_,E,g,p,m[t+15],16,530742520),p=l(p,_,E,g,m[t+2],23,3299628645),g=u(g,p,_,E,m[t+0],6,4096336452),E=u(E,g,p,_,m[t+7],10,1126891415),_=u(_,E,g,p,m[t+14],15,2878612391),p=u(p,_,E,g,m[t+5],21,4237533241),g=u(g,p,_,E,m[t+12],6,1700485571),E=u(E,g,p,_,m[t+3],10,2399980690),_=u(_,E,g,p,m[t+10],15,4293915773),p=u(p,_,E,g,m[t+1],21,2240044497),g=u(g,p,_,E,m[t+8],6,1873313359),E=u(E,g,p,_,m[t+15],10,4264355552),_=u(_,E,g,p,m[t+6],15,2734768916),p=u(p,_,E,g,m[t+13],21,1309151649),g=u(g,p,_,E,m[t+4],6,4149444226),E=u(E,g,p,_,m[t+11],10,3174756917),_=u(_,E,g,p,m[t+2],15,718787259),p=u(p,_,E,g,m[t+9],21,3951481745),g=n(g,i),p=n(p,r),_=n(_,o),E=n(E,a);return(f(g)+f(p)+f(_)+f(E)).toLowerCase()}(e)}function o(e){for(var t in e)U.has(e,t)&&(this[t]=e[t])}function a(e){var t=U.toArray(arguments);switch(e=t.shift()){case"init":return c.apply(this,t);case"track":return d.apply(this,t);case"track_custom":return l.apply(this,t);case"track_visually":return f.apply(this,t);default:U.logError('Invalid or unknown method name "'+e+'"')}}function s(t){te.isBrowserSupported()&&(se&&U.sendMessageToDMP({type:"BASE_CODE_INSTALLED",userActionSetId:t}),te.init(t,ne),se&&e.parent===e.top&&Q.init(t,ne))}function c(e){var t=(new Date).getTime();if(!e||0==e)return U.logError("Illegal Pixel ID: "+e),void m(1001,-1,"Illegal Pixel ID",e,-1,t,"");if(U.has(re,e))return U.logError("Duplicate Pixel ID: "+e),void m(1001,-2,"Duplicate Pixel ID",e,-1,t,"");var n={id:e};ie.push(n),re[e]=n,m(1e3,0,"",e,-1,t,""),s(e)}function l(e,t,n){t=t||{};var i=G.validateActionParam(e,t);if(i.error&&U.logError(i.error),i.warnings)for(var a=0,s=i.warnings.length;a<s;a++)U.logWarning(i.warnings[a]);var c=this instanceof o?this:pe,l="PAGE_VIEW"===e,d=h(e,t,n);d.unique_action_id=r(JSON.stringify(d)+JSON.stringify(ie)+(new Date).getTime()+u());for(var f=0,p=ie.length;f<p;f++)if(!l||!1!==c.allowDuplicatePageViews||!0!==oe[ie[f].id]){if(l&&te.state!==A.NORMAL)return;g(ie[f],d),l&&(oe[ie[f].id]=!0)}}function u(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}function d(e,t){var n=G.validateActionType(e,t);if(n.error&&U.logError(n.error),n.warnings)for(var i=0,r=n.warnings.length;i<r;i++)U.logWarning(n.warnings[i]);l.call(this,e,t,null)}function f(e,t,n){l.call(this,e,t,n)}function h(e,t,n){var i={};return i.url=ce,i.js_version=v.SDK_VERSION,i.is_iframe=se,y[e]?i.action_type=e:(i.action_type="CUSTOM",i.custom_action=e),n&&n.vtrack&&(2===ne.bt?i.code_type=2:i.code_type=1),U.isEmpty(ae)||(i.referrer=ae),U.isEmpty(ge)?U.isEmpty(he)||(i.qz_gdt=he):i.qz_gdt=ge,U.has(t,"url")&&(U.logError('Parameter "url" in your action param is invalid.'),delete t.url),U.has(t,ue)&&(i[ue]=t[ue],delete t[ue]),U.isEmpty(t)||(i.action_param=t),i}function g(e,t){e=e||{},t.user_action_set_id=e.id;var n=U.HTTPBuildQuery(t);2e3>(le+"?"+n).length?_(le,t,n):(E(le,t),m(1008,0,"",t.user_action_set_id,t.unique_action_id,(new Date).getTime(),p(t)))}function p(e){return"CUSTOM"===e.action_type?e.custom_action:e.action_type}function _(e,t,n){var i=new Image,r=(new Date).getTime();i.onload=function(){m(1008,0,"",t.user_action_set_id,t.unique_action_id,r,p(t))},i.onerror=function(){m(1009,-3,"pixel err",t.user_action_set_id,t.unique_action_id,r,p(t)),U.logError("Action report failed.")},i.src=e+"?"+n}function E(n,i){var r="gdt_"+Math.random().toString().replace(".",""),o=t.createElement("form");o.method="post",o.action=n,o.target=r,o.acceptCharset="utf-8",o.style.display="none";var a=!(!e.attachEvent||e.addEventListener)?'<iframe name="'+r+'">':"iframe",s=t.createElement(a);s.src="javascript:false",s.id=r,s.name=r,o.appendChild(s),U.listenOnce(s,"load",function(){U.each(i,function(e,n){var i=t.createElement("input");i.name=n,i.value=U.isObject(e)?U.JSONEncode(e):e.toString(),o.appendChild(i)}),U.listenOnce(s,"load",function(){o.parentNode.removeChild(o)}),o.submit()}),t.body.appendChild(o)}function m(e,t,n,i,r,o,a){var s=(new Date).getTime()-o;try{var c=[{eventId:e,errorCode:t,errorMsg:n,duration:s,actionType:a}],l={bid:10021014,netType:navigator.connection.effectiveType,osType:1,actionSetId:i,uniqActionId:r,osVersion:v.SDK_VERSION,body:c};U.log("dp3 rep：\n"+JSON.stringify(l)),ne._send_request_post(fe,l,null)}catch(e){U.logError("dp3 err:"+e)}}var v={SDK_VERSION:"1.4.3"},y={PAGE_VIEW:{},VIEW_CONTENT:{},SEARCH:{},REGISTER:{},CONSULT:{},ADD_TO_CART:{},ADD_TO_WISHLIST:{},INITIATE_CHECKOUT:{},COMPLETE_ORDER:{},PURCHASE:{},RESERVATION:{},DOWNLOAD_APP:{},START_APP:{},RATE:{},SHARE:{},APPLY:{},CLAIM_OFFER:{},NAVIGATE:{},PRODUCT_RECOMMEND:{},VISIT_STORE:{},TRY_OUT:{},DELIVER:{},SIGN_IN:{},CREATE_ROLE:{},AUTHORIZE:{},TUTORIAL_FINISH:{},CONFIRM_EFFECTIVE_LEADS:{},CONFIRM_POTENTIAL_CUSTOMER:{},SCANCODE:{}},T={debug:!1},S={ENTER_EDIT_STATE:"ENTER_EDIT_STATE",EDITING_ACTION:"EDITING_ACTION",PREVIEW_ACTION:"PREVIEW_VISUAL_ACTION",SHOW_SELECTED_ELEMENTS:"SHOW_SELECTED_ELEMENTS"},b={TRACKER_READY:"TRACKER_READY",CHOOSE_ELEMENT:"CHOOSE_ELEMENT",REPORTING_VISUAL_ACTION:"REPORTING_VISUAL_ACTION",PAGE_UNLOAD:"PAGE_UNLOAD",HAS_INVALID_CONFIG:"HAS_INVALID_CONFIG"},A={NORMAL:0,EDIT:1,PREVIEW:2},C=Array.prototype,O=Function.prototype,L=Object.prototype,I=C.slice,N=L.toString,D=L.hasOwnProperty,w=(e.navigator.userAgent,n.protocol),P=O.bind,M=C.forEach,x=Array.isArray,R={},q=!("addEventListener"in t),k=e.console||{},H=e.postMessage||function(){},V="https:"!==w&&"http:"!==w?"http://report.huatuo.qq.com/code.cgi":"//report.huatuo.qq.com/code.cgi",U={trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}};U.each=function(e,t,n){if(null!==e&&void 0!==e)if(M&&e.forEach===M)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,r=e.length;i<r;i++)if(i in e&&t.call(n,e[i],i,e)===R)return}else for(var o in e)if(D.call(e,o)&&t.call(n,e[o],o,e)===R)return},U.has=function(e,t){return null!=e&&D.call(e,t)},U.includes=function(e,t){return-1!==e.indexOf(t)},U.isUndefined=function(e){return void 0===e},U.isNull=function(e){return null===e},U.isArray=x||function(e){return"[object Array]"==N.call(e)},U.isArguments=function(e){return!(!e||!D.call(e,"callee"))},U.isFunction=function(e){try{return/^\s*\bfunction\b/.test(e)}catch(e){return!1}},U.isObject=function(e){return e===Object(e)&&!U.isArray(e)},U.isString=function(e){return"[object String]"==N.call(e)},U.isDate=function(e){return"[object Date]"==N.call(e)},U.isNumber=function(e){return"[object Number]"==N.call(e)},U.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==N.call(e)},U.isElement=function(e){return!(!e||1!==e.nodeType)},U.isEmpty=function(e){if(null==e)return!0;if(U.isArray(e)||U.isString(e))return 0===e.length;for(var t in e)if(U.has(e,t))return!1;return!0},U.extend=function(e){return U.each(I.call(arguments,1),function(t){for(var n in t)void 0!==t[n]&&(e[n]=t[n])}),e},U.keys=function(e){var t=[];return null===e?t:(U.each(e,function(e,n){t[t.length]=n}),t)},U.values=function(e){var t=[];return null===e?t:(U.each(e,function(e){t[t.length]=e}),t)},U.toArray=function(e){return e?e.toArray?e.toArray():U.isArray(e)?I.call(e):U.isArguments(e)?I.call(e):U.values(e):[]};var j=function(){};U.bind=function(e,t){var n,i;if(P&&e.bind===P)return P.apply(e,I.call(arguments,1));if(!U.isFunction(e))throw new TypeError;return n=I.call(arguments,2),i=function(){if(!(this instanceof i))return e.apply(t,n.concat(I.call(arguments)));j.prototype=e.prototype;var r=new j;j.prototype=null;var o=e.apply(r,n.concat(I.call(arguments)));return Object(o)===o?o:r}},U.getQueryParam=function(e,t){var n="[\\?&]"+t+"=([^&#]*)",i=new RegExp(n).exec(e);return null===i||i&&"string"!=typeof i[1]&&i[1].length?"":decodeURIComponent(i[1]).replace(/\+/g," ")},U.HTTPBuildQuery=function(e,t){var n,i,r=[];return U.isUndefined(t)&&(t="&"),U.each(e,function(e,t){n=U.isArray(e)||U.isObject(e)?encodeURIComponent(U.JSONEncode(e)):encodeURIComponent(e.toString()),i=encodeURIComponent(t),r[r.length]=i+"="+n}),r.join(t)},U.register_event=function(){function t(t,i,r){return function(o){if(o=o||n(e.event)){var a,s,c=!0;return U.isFunction(r)&&(a=r(o)),s=i.call(t,o),!1!==a&&!1!==s||(c=!1),c}}}function n(e){return e&&(e.preventDefault=n.preventDefault,e.stopPropagation=n.stopPropagation),e}return n.preventDefault=function(){this.returnValue=!1},n.stopPropagation=function(){this.cancelBubble=!0},function(e,n,i,r,o){if(e)if(e.addEventListener&&!r)e.addEventListener(n,i,!!o);else{var a="on"+n,s=e[a];e[a]=t(e,i,s)}else U.logError("No valid element provided!")}}(),U.isElementVisible=function(){function n(e,t){for(;e;){if(e===t)return!0;e=e.parentNode}return!1}var i=e.pageXOffset?e.pageXOffset+e.innerWidth-1:0,r=e.pageYOffset?e.pageYOffset+e.innerHeight-1:0,o=!((i||r)&&t.elementFromPoint(i,r));return function(i){if(t.hidden||0==i.offsetWidth||0==i.offsetHeight||"hidden"==i.style.visibility||"none"==i.style.display||0===i.style.opacity)return!1;var r=i.getBoundingClientRect();if(o){if(!n(t.elementFromPoint(r.left+i.offsetWidth/2,r.top+i.offsetHeight/2),i))return!1}else if(!n(t.elementFromPoint(r.left+i.offsetWidth/2+e.pageXOffset,r.top+i.offsetHeight/2+e.pageYOffset),i)||r.top+i.offsetHeight/2<0||r.left+i.offsetWidth/2<0||r.bottom-i.offsetHeight/2>(e.innerHeight||t.documentElement.clientHeight)||r.right-i.offsetWidth/2>(e.innerWidth||t.documentElement.clientWidth))return!1;if(e.getComputedStyle||i.currentStyle)for(var a=i,s=null;a&&a!==t;){if(!a.parentNode)return!1;if((s=e.getComputedStyle?e.getComputedStyle(a,null):a.currentStyle)&&("hidden"==s.visibility||"none"==s.display||void 0!==s.opacity&&1!=s.opacity))return!1;a=a.parentNode}return!0}}(),U.log=function(e){T.debug&&"log"in k&&k.log(e)},U.logError=function(e){H({action:"GDT_LOG",logType:"GDT_Pixel_Error",logMessage:e},"*"),"error"in k&&k.error("GDT_Pixel_Error: "+e)},U.logWarning=function(e){H({action:"GDT_LOG",logType:"GDT_Pixel_Warning",logMessage:e},"*"),"warn"in k&&k.warn("GDT_Pixel_Warning: "+e)},U.listenOnce=function(e,t,n){t=q?"on"+t:t;var i=q?"attachEvent":"addEventListener",r=q?"detachEvent":"removeEventListener";e[i](t,function i(){e[r](t,i,!1),n()},!1)},U.injectMethod=function(e,t,n){var i=e[t];e[t]=function(){var e=i.apply(this,arguments);return n.apply(this,arguments),e}},U.retCodeService=function(e,t,n,i){var r=(new Date).getTime()-i,o={appid:20187,platform:"web",domain:"a.gdt.qq.com",cgi:e,type:t?1:2,code:n,time:r,rate:1};(new Image).src=V+"?"+U.HTTPBuildQuery(o)},U.JSONEncode=function(e){var t=function(e){var t=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return t.lastIndex=0,t.test(e)?'"'+e.replace(t,function(e){var t=n[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'},n=function(e,i){var r="",o=0,a="",s="",c=0,l=r,u=[],d=i[e];switch(d&&"object"==typeof d&&"function"==typeof d.toJSON&&(d=d.toJSON(e)),typeof d){case"string":return t(d);case"number":return isFinite(d)?String(d):"null";case"boolean":case"null":return String(d);case"object":if(!d)return"null";if(r+="",u=[],"[object Array]"===N.apply(d)){for(c=d.length,o=0;o<c;o+=1)u[o]=n(o,d)||"null";return s=0===u.length?"[]":r?"[\n"+r+u.join(",\n"+r)+"\n"+l+"]":"["+u.join(",")+"]",r=l,s}for(a in d)D.call(d,a)&&(s=n(a,d))&&u.push(t(a)+(r?": ":":")+s);return s=0===u.length?"{}":r?"{"+u.join(",")+l+"}":"{"+u.join(",")+"}",r=l,s}};return n("",{"":e})},U.JSONDecode=function(){var e,t,n,i,r={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},o=function(t){throw{name:"SyntaxError",message:t,at:e,text:n}},a=function(i){return i&&i!==t&&o("Expected '"+i+"' instead of '"+t+"'"),t=n.charAt(e),e+=1,t},s=function(){var e,n="";for("-"===t&&(n="-",a("-"));t>="0"&&t<="9";)n+=t,a();if("."===t)for(n+=".";a()&&t>="0"&&t<="9";)n+=t;if("e"===t||"E"===t)for(n+=t,a(),"-"!==t&&"+"!==t||(n+=t,a());t>="0"&&t<="9";)n+=t,a();if(e=+n,isFinite(e))return e;o("Bad number")},c=function(){var e,n,i,s="";if('"'===t)for(;a();){if('"'===t)return a(),s;if("\\"===t)if(a(),"u"===t){for(i=0,n=0;n<4&&(e=parseInt(a(),16),isFinite(e));n+=1)i=16*i+e;s+=String.fromCharCode(i)}else{if("string"!=typeof r[t])break;s+=r[t]}else s+=t}o("Bad string")},l=function(){for(;t&&t<=" ";)a()},u=function(){switch(t){case"t":return a("t"),a("r"),a("u"),a("e"),!0;case"f":return a("f"),a("a"),a("l"),a("s"),a("e"),!1;case"n":return a("n"),a("u"),a("l"),a("l"),null}o('Unexpected "'+t+'"')},d=function(){var e=[];if("["===t){if(a("["),l(),"]"===t)return a("]"),e;for(;t;){if(e.push(i()),l(),"]"===t)return a("]"),e;a(","),l()}}o("Bad array")},f=function(){var e,n={};if("{"===t){if(a("{"),l(),"}"===t)return a("}"),n;for(;t;){if(e=c(),l(),a(":"),Object.hasOwnProperty.call(n,e)&&o('Duplicate key "'+e+'"'),n[e]=i(),l(),"}"===t)return a("}"),n;a(","),l()}}o("Bad object")};return i=function(){switch(l(),t){case"{":return f();case"[":return d();case'"':return c();case"-":return s();default:return t>="0"&&t<="9"?s():u()}},function(r){var a;return n=r,e=0,t=" ",a=i(),l(),t&&o("Syntax error"),a}}(),U.bind_instance_methods=function(e){for(var t in e)"function"==typeof e[t]&&(e[t]=U.bind(e[t],e))},U.safewrap_instance_methods=function(e){for(var t in e)"function"==typeof e[t]&&(e[t]=U.safewrap(e[t]))},U.safewrap=function(e){return function(){try{return e.apply(this,arguments)}catch(e){U.logError("Internal error. Please contact dmp@tencent.com.")}}},U.sendMessageToDMP=function(t){e.parent.postMessage(t,"*")},U.queryElement=function(e){return t.querySelector(e)};for(var G=function(){function e(e,t){this.actionType=e,this.actionParam=t||{},this.error=null,this.warnings=[]}return e.prototype={validateActionType:function(){return y[this.actionType]||this.warnings.push('You are sending a non-standard action "'+this.actionType+'". The preferred way to send custom action is using track_custom.'),this},validateActionParam:function(){var e=/^[_a-zA-Z0-9]+$/,t=this;return U.each(this.actionParam,function(n,i){if(e.test(i)||t._error("Action parameter's key \""+i+'" can only contain String, Number and Underline.'),U.isArray(n))for(var r=0,o=n.length;r<o;r++)U.isObject(n[r])&&t._error('Action parameter "'+i+'" value can not contain Object.');else U.isObject(n)&&t._error('Action parameter "'+i+"'s value\" can not be Object.")}),this},_error:function(e){return this.error=e,this}},{validateActionType:function(t,n){return new e(t,n).validateActionType()},validateActionParam:function(t,n){return new e(t,n).validateActionParam()}}}(),B=["//de.qq.com","onedata.qq.com"],F=".tsa-union-behavior-config-handle-hover{position:absolute;box-sizing:border-box;cursor:pointer;border:2px solid #1690e5;background:rgba(22,144,229,.5);z-index:2147483647;pointer-events:none;}.tsa-union-behavior-config-handle-selected{position:absolute;box-sizing:border-box;cursor:pointer;border:2px solid #DB27DB;background-color: rgba(219,39,219,.5);z-index:2147483647;pointer-events:none;}",W="tsa-union-behavior-config-handle-selected",J="tsa-union-behavior-config-handle-hover",Y="selected-highlight-element",z=["dmpVtrackEditor","hover-highlight-element",Y],X=[],K=0;K<5;K++)X.push("show-highlight-element-"+K),z.push("show-highlight-element-"+K);var Q={_editingActionList:[],_showAllSelectedElement:!1,_coverElements:{},init:function(i,r){if(t&&t.body){e.addEventListener("message",U.bind(this._vtrackMessageListener,this)),e.addEventListener("beforeunload",U.bind(this._pageUnloadListener,this)),e.addEventListener("onunload",U.bind(this._pageUnloadListener,this)),U.sendMessageToDMP({type:b.TRACKER_READY,userActionSetId:i,editUrl:n.href,title:t.title}),this._loadInlineCss();var o=t.createElement("dmp-vtrack-editor");this._setAttr(o,"id","dmpVtrackEditor"),this._append(t.getElementsByTagName("body")[0],o)}else{U.log("document not ready yet, trying again in 500 milliseconds...");var a=this;setTimeout(function(){a.init(i,r)},500)}},_originCheck:function(e){var t=!1;return U.each(B,function(n){-1===e.indexOf(n)||(t=!0)}),t},_vtrackMessageListener:function(n){if(!1!==T.debug||this._originCheck(n.origin)){var i=n.data;if("GDT_LOG"!==i.action)switch(U.isNull(this._bindedMouseOverListener)&&(this._bindedMouseOverListener=U.bind(this._editMouseOverListener,this)),U.isNull(this._bindedMouseOutListener)&&(this._bindedMouseOutListener=U.bind(this._editMouseOutListener,this)),U.isNull(this._bindedClickListener)&&(this._bindedClickListener=U.bind(this._editClickListener,this)),U.isNull(this._bindedCoversObserver)&&(this._bindedCoversObserver=U.bind(this._updateCovers,this)),i.type){case S.ENTER_EDIT_STATE:U.log("Enter visual config edit mode"),te.state=A.EDIT,this._editingActionList=i.editingActionList,t.addEventListener("mouseover",this._bindedMouseOverListener,!0),t.addEventListener("mouseout",this._bindedMouseOutListener,!0),t.addEventListener("click",this._bindedClickListener,!0),e.setInterval(this._bindedCoversObserver,500),this._validateConfigList(i.editingActionList);break;case S.EDITING_ACTION:U.log("DMP Web is editing action"),U.log(i),this._editingActionList=i.editingActionList,this._updateCoverElements(),this._updateCovers(),this._updateScrollPosition();break;case S.PREVIEW_ACTION:U.log("Enter preview mode"),te.state=A.PREVIEW,this._hideSelectedElement(),this._hideHoverElement();break;case S.SHOW_SELECTED_ELEMENTS:this._showAllSelectedElement=i.show,i.show?(U.log("Show all selected elements"),this._showAllSelectedElements()):(U.log("Hide all selected elements"),this._hideAllSelectedElements())}else U.log("Filter GDT_LOG message")}else U.log("Filter fake message")},_pageUnloadListener:function(e){U.sendMessageToDMP({type:b.PAGE_UNLOAD,url:n.href})},_updateCoverElements:function(){var e=this;this._coverElements={},U.each(this._editingActionList,function(t,n){var i=U.queryElement(t.actionElementSelector);i&&(e._coverElements["show-highlight-element-"+n]=i,t.selected&&(e._coverElements[Y]=i))})},_bindedCoversObserver:null,_updateCovers:function(){var e=this._coverElements[Y];e&&U.isElementVisible(e)&&te.state!==A.PREVIEW?this._showCover(e,Y,W):this._hideSelectedElement();var t=this;U.each(X,function(e){var n=t._coverElements[e];n&&U.isElementVisible(n)&&t._showAllSelectedElement?t._showCover(n,e,"tsa-union-behavior-config-handle-selected"):t._hideSelectedHighlightElement(e)})},_updateScrollPosition:function(){var e=this._coverElements[Y];t.documentElement.scrollIntoView&&e&&e.scrollIntoView()},_validateConfigList:function(e){var t=!1,i=[];U.each(e,function(e,n){U.queryElement(e.actionElementSelector)||(t=!0,i.push(e))}),t&&U.sendMessageToDMP({type:b.HAS_INVALID_CONFIG,invalidActionConfigList:i,editUrl:n.href})},_bindedClickListener:null,_editClickListener:function(e){if(!e.shiftKey){var t=e.target;this._hasClass(t,W)||"dmpVtrackEditor"===t.id||(e.preventDefault(),e.stopImmediatePropagation(),("hover-highlight-element"===t.id||U.includes(t.id,"show-highlight-element-"))&&(t=this._coverElements[t.id]),te.state===A.PREVIEW?this._previewElement(t):te.state===A.EDIT&&this._chooseElement(t))}},_bindedMouseOverListener:null,_editMouseOverListener:function(e){if(te.state===A.EDIT){var t=e.target;this._shouldTrackElement(t)?this._isInDMPVtrackEditor(t)||(e.stopPropagation(),this._showCover(t,"hover-highlight-element",J)):this._hideHoverElement()}},_bindedMouseOutListener:null,_editMouseOutListener:function(e){var t=e.target;this._shouldTrackElement(t)&&this._hasClass(t,J)&&(e.stopPropagation(),this._hideHoverElement())},_hasClass:function(e,t){if(e.classList)return e.classList.contains(t);var n=/[\t\r\n]/g,i=" "+t+" ";return(" "+e.className+" ").replace(n," ").indexOf(i)>=0},_addClass:function(e,t){e.classList?e.classList.add(t):this._hasClass(e,t)||(e.className+=" "+t)},_removeClass:function(e,t){if(e.classList)e.classList.remove(t);else if(this._hasClass(e,t)){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")}},_loadInlineCss:function(){var e=t.createElement("style");e.type="text/css";try{e.appendChild(t.createTextNode(F))}catch(t){e.styleSheet.cssText=F}t.getElementsByTagName("head")[0].appendChild(e)},_previewElement:function(e){U.isEmpty(this._editingActionList)||U.each(this._editingActionList,function(t){U.queryElement(t.actionElementSelector)===e&&U.sendMessageToDMP({type:b.REPORTING_VISUAL_ACTION,actionType:t.actionType,customActionType:t.customActionType})})},_chooseElement:function(e){if(this._shouldTrackElement(e)){var t=-1,i=-2;if(U.each(this._editingActionList,function(n,r){var o=U.queryElement(n.actionElementSelector);o&&o===e&&(t=r),n.selected&&(i=r)}),-1!==t){if(i===t)return;return U.each(this._editingActionList,function(e,n){e.selected=n===t}),U.sendMessageToDMP({type:b.CHOOSE_ELEMENT,editUrl:n.href,editingActionList:this._editingActionList,operation:"SELECT_EXIST_ELEMENT"}),void this._showCover(e,Y,W)}if(this._editingActionList.length>=5)U.sendMessageToDMP({type:b.CHOOSE_ELEMENT,editUrl:n.href,operation:"EXCEED_NUM_LIMIT"});else{var r={visualTrackId:-1*(new Date).getTime(),actionElementSelector:this._getUniqueSelector(e),state:"ADD",selected:!0};U.each(this._editingActionList,function(e){e.selected=!1}),this._editingActionList.push(r),U.sendMessageToDMP({type:b.CHOOSE_ELEMENT,editUrl:n.href,editingActionList:this._editingActionList,operation:"ADD_ELEMENT"}),this._showCover(e,Y,W),this._showAllSelectedElement&&this._showAllSelectedElements()}}},_showAllSelectedElements:function(){var e=this;U.each(this._editingActionList,function(t,n){if(n>5)U.logError("Action config exceeded, maximum is 5!");else{var i=U.queryElement(t.actionElementSelector);i?e._showCover(i,"show-highlight-element-"+n,"tsa-union-behavior-config-handle-selected"):U.error("Can not find selected elements！")}})},_hideSelectedHighlightElement:function(e){var t=U.queryElement("#"+e);t&&this._css(t,{display:"none"})},_hideAllSelectedElements:function(){for(var e=0;e<5;e++){var t=U.queryElement("#show-highlight-element-"+e);t&&this._css(t,{display:"none"})}},_hideSelectedElement:function(){var e=U.queryElement("#"+Y);e&&this._css(e,{display:"none"})},_hideHoverElement:function(){var e=U.queryElement("#hover-highlight-element");e&&this._css(e,{display:"none"})},_showCover:function(e,n,i){var r=t.querySelector("#dmpVtrackEditor");if(r){var o=this._getBoundingBox(e),a=n,s=t.getElementById(a);s||(s=t.createElement("div"),this._setAttr(s,"id",a),this._append(r,s)),this._coverElements[a]=e,this._addClass(s,i),this._css(s,{width:o.width+"px",height:o.height+"px",left:o.left+"px",top:o.top+"px",display:"table",position:o.position})}},_getPosition:function(e){for(var t="fixed"===this._css(e,"position")?"fixed":"absolute";e.offsetParent;){var n=e.offsetParent;"fixed"===this._css(n,"position")&&(t="fixed"),e=n}return t},_getBoundingBox:function(t){var n=this._getPosition(t),i={height:0,left:0,top:0,width:0,position:this._getPosition(t)};if(t){var r=this.__getElementBounds(t);U.extend(i,{height:r.bottom-r.top+0,left:"fixed"===n?r.left-0:r.left+(e.scrollX||e.pageXOffset)-0,top:"fixed"===n?r.top-0:r.top+(e.scrollY||e.pageYOffset)-0,width:r.right-r.left+0})}return i},__getElementBounds:function(e){var t,n=e.children.length===e.childNodes.length;if("a"===e.tagName.toLowerCase()&&e.children.length>0&&n){var i=[];U.each(e.children,function(e){var t=getComputedStyle(e);"a"!==e.tagName&&"none"!==t.display&&i.push(e)}),U.each(i,function(e){var n=e.getBoundingClientRect();t||(t={top:n.top,right:n.right,bottom:n.bottom,left:n.left}),n.top<t.top&&(t.top=n.top),n.right>t.right&&(t.right=n.right),n.bottom>t.bottom&&(t.bottom=n.bottom),n.left<t.left&&(t.left=n.left)})}else t=e.getBoundingClientRect();return t||(t={top:0,right:0,bottom:0,left:0}),t},_setAttr:function(e,t,n){if(U.isObject(t)){var i;for(i in t)e.setAttribute(i,t[i])}else e.setAttribute(t,n)},_append:function(e,t){U.isString(t)?e.insertAdjacentHTML("beforeend",t):e.appendChild(t)},_css:function(t,n){if(U.isString(n))return e.getComputedStyle(t)[n];var i;for(i in n)t.style[i]=n[i]},_extractElementContent:function(e){return["input","select"].indexOf(this._getTagName(e))>-1?e.value:e.textContent||e.innerText||this._getAttr(e,"type")||e.value||""},_isHTMLTag:function(e){return"html"===this._getTagName(e)},_isBodyTag:function(e){return"body"===this._getTagName(e)},_isTextNode:function(e){return"#text"===e.nodeName||3===e.nodeType},_shouldTrackElement:function(e){return!(!e||this._isTextNode(e)||this._isHTMLTag(e)||this._isBodyTag(e))},_isInDMPVtrackEditor:function(e){var t=e.id,n=!1;return U.each(z,function(e){e===t&&(n=!0)}),n},_getTagName:function(e){return e.tagName?e.tagName.toLowerCase():""},_getAttr:function(e,t){return e.getAttribute(t)},_getParent:function(e){return e.parentNode},_previousElementSibling:function(e){if(e.previousElementSibling)return e.previousElementSibling;do{e=e.previousSibling}while(e&&1!==e.nodeType);return e},_getIndexInParent:function(e){for(var t=1,n=1,i=e;i=this._previousElementSibling(i);)t++,i.tagName===e.tagName&&n++;return{nthChild:t,nthOfType:n}},_classNameFilter:function(e){return!!e&&!["odd","even","active","selected","highlight","required","req","first","last","hover",W,"tsa-union-behavior-config-handle-selected","ignore-gdt-dmp-vtrack",J].includes(e)&&!e.includes("(")},_getSelector:function(e){var t=this._getAttr(e,"id"),n=this._getTagName(e),i=(this._getAttr(e,"class")||"").trim().split(/\s/).filter(this._classNameFilter).filter(function(e){return"ignore-gdt-dmp-vtrack".indexOf(e)<0});return t?"#"+t:i.length>0?n+"."+i.join("."):n},_getUniqueSelector:function(e,n){var i=this._getSelector(e);return 1===t.querySelectorAll(i).length?(n&&(i=i+">"+n),i):"body"===this._getTagName(e)||"html"===this._getTagName(e)?(n&&(i=i+">"+n),i):(i+=":nth-of-type("+this._getIndexInParent(e).nthOfType+")",n&&(i=i+">"+n),this._getUniqueSelector(this._getParent(e),i))}},$="https:"!==n.protocol&&"http:"!==n.protocol?"http://a.gdt.qq.com/config":"//a.gdt.qq.com/config",Z=!1,ee=!1,te={state:A.NORMAL,_actionConfigList:[],init:function(e,t){this._gdtLib=t,this._userActionSetId=e;var i=(new Date).getTime(),r=U.bind(function(e){Z=!0,e&&0===e.code?(U.retCodeService("/config",!0,0,i),this._actionConfigList=e.data):U.retCodeService("/config",!1,500,i)},this);this._addDomGlobalHandler(t,i),t._send_request($,{user_action_set_id:e,url:n.href,code_type:2===t.bt?2:1},t._prepare_callback(r))},_addDomGlobalHandler:function(n,i){if(n.bt)if(t&&t.body){var r=this,o="ontouchstart"in e?"touchstart":"click",a=U.bind(function(t){if(Z){if(!U.isEmpty(r._actionConfigList)&&n){var o=(t=t||e.event).target,a=Q._getUniqueSelector(o);U.each(r._actionConfigList,function(e){e.selector===a&&r._trackEvent(t,n,e,o)}),ee||r._checkDomExistence(n,r._actionConfigList),ee=!0}}else U.retCodeService("/slowconfig",!0,0,i)},r);U.register_event(t,o,a,!1,!0)}else{var s=this;setTimeout(function(){s._addDomGlobalHandler(n,i)},200)}},_checkDomExistence:function(e,i){if(!U.isEmpty(i)&&e){var r=i,o=this;U.each(r,function(e){var i=t.querySelectorAll(e.selector);if(!i||1!==i.length){var r="",a={error:r=i.length>=1?"ElementNotUnique":"ElementNotFound",userActionSetId:o._userActionSetId,url:n.href,extra:e},s=encodeURIComponent(U.JSONEncode(a));(new Image).src="//a.gdt.qq.com/err?c=dmp_js_vtrack_warn&m="+s}})}},domLoaded:function(){},_trackEvent:function(e,t,n,i){var r=n.action_type;y[r]||(r=n.custom_action),t("track_visually",r,null,{vtrack:!0})},isBrowserSupported:function(){return U.isFunction(t.querySelector)}};U.bind_instance_methods(te),U.safewrap_instance_methods(te),function(){function n(){n.done||(n.done=!0,te.domLoaded())}function i(){try{t.documentElement.doScroll("left")}catch(e){return void setTimeout(i,1)}n()}if(t.addEventListener)"complete"===t.readyState?n():t.addEventListener("DOMContentLoaded",n,!1);else if(t.attachEvent){t.attachEvent("onreadystatechange",n);var r=!1;try{r=null===e.frameElement}catch(e){}t.documentElement.doScroll&&r&&i()}U.register_event(e,"load",n,!0)}();var ne=e.gdt;if(!ne)throw U.logError("GDT Pixel code is not installed correctly on this page."),{message:"GDT Pixel code is not installed correctly on this page"};var ie=[],re={},oe={},ae=t.referrer,se=e.top!==e.self,ce=n.href,le="https:"!==n.protocol&&"http:"!==n.protocol?"http://a.gdt.qq.com/pixel":"//a.gdt.qq.com/pixel",ue="outer_action_id",de=!!e.XMLHttpRequest;ne._jsCallbacks=function(){};var fe="https:"!==n.protocol&&"http:"!==n.protocol?"http://dp3.qq.com/stdlog":"//dp3.qq.com/stdlog",he=U.getQueryParam(ce,"qz_gdt");he&&e.localStorage&&e.localStorage.setItem&&e.localStorage.setItem("qz_gdt",he),!he&&e.localStorage&&e.localStorage.getItem&&(he=e.localStorage.getItem("qz_gdt"));var ge=U.getQueryParam(ce,"gdt_vid");ge&&e.localStorage&&e.localStorage.setItem&&e.localStorage.setItem("gdt_vid",ge),!ge&&e.localStorage&&e.localStorage.getItem&&(ge=e.localStorage.getItem("gdt_vid"));var pe={allowDuplicatePageViews:!1};ne.tk=a,ne._prepare_callback=function(e,t){if(U.isUndefined(e))return null;if(de){return function(n){e(n,t)}}var n=ne._jsCallbacks,i=""+Math.floor(1e8*Math.random()),r="gdt._jsCallbacks["+i+"]";return n[i]=function(r){delete n[i],e(r,t)},r},ne._send_request=function(e,n,i){if(de||(n.callback=i||"(function(){})"),e+="?"+U.HTTPBuildQuery(n),de)try{var r=new XMLHttpRequest;r.open("GET",e,!0),r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status)i&&i(U.JSONDecode(r.responseText));else{var e="Bad HTTP status: "+r.status+" "+r.statusText;U.logError(e),i&&i({status:r.status,error:e})}},r.send(null)}catch(e){U.logError(e)}else{var o=t.createElement("script");o.type="text/javascript",o.async=!0,o.defer=!0,o.src=e;var a=t.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)}},ne._send_request_post=function(e,t,n){try{var i=new XMLHttpRequest;i.open("POST",e),i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status)n&&n(U.JSONDecode(i.responseText));else{var e="Bad HTTP status: "+i.status+" "+i.statusText;U.logError(e),n&&n({status:i.status,error:e})}},i.send(JSON.stringify(t))}catch(e){U.logError(e)}},function(){for(;ne.queue.length;){var e=ne.queue.shift();a.apply(ne,e)}}(),ie.length>1&&U.logWarning("Multiple different pixels were detected on this page."),function(){if(!0!==ne.disablePushState&&i.pushState&&i.replaceState){var t=function(){var e=ce;if((ce=n.href)!==e){var t=new o({allowDuplicatePageViews:!0});a.call(t,"track","PAGE_VIEW")}};U.injectMethod(i,"pushState",t),U.injectMethod(i,"replaceState",t);var r="pushState"in i?"popstate":"hashchange";e.addEventListener(r,t,!1)}}()}(window,document,location,history);}catch(e){var errorMsg = encodeURIComponent('{"error":"LOAD","extra":{"name":"'+e.name+'","line":"'+(e.lineNumber||e.line)+'","script":"'+(e.fileName||e.sourceURL||e.script)+'","stack":"'+(e.stackTrace||e.stack)+'","revision":"1","namespace":"GDT","message":"'+e.message+'"}}');new Image().src="//a.gdt.qq.com/"+'err?c=dmp_js_sdk_error&m='+errorMsg;}
